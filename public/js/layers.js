L.GridLayer.Lidar=L.GridLayer.extend({createTile:function(e,o){var l=document.createElement("canvas"),t=this.getTileSize();l.setAttribute("width",t.x),l.setAttribute("height",t.y);var d=l.getContext("2d"),n=e.x,a=Math.abs(e.y)-1;return fetch("/lidar?lat="+n+"&lon="+a).then(function(e){return e.json()}).then(function(e){for(var t=e.data,n=0;n<t.length;n++)for(var a=t[n],r=0;r<a.length;r++){a[r]<0&&(a[r]=0);var i=a[r]/120;d.fillStyle="rgba(0,0,0,"+i+")",d.fillRect(r,n,1,1)}o(null,l)}).catch(function(e){console.log(e)}),l}}),L.gridLayer.lidar=function(e){return new L.GridLayer.Lidar(e)},map.addLayer(L.gridLayer.lidar());var SunPositionLayer=L.CanvasLayer.extend({render:function(){var e=this.getCanvas(),t=e.getContext("2d");t.clearRect(0,0,e.width,e.height),console.log(getSunAzis(MAP_CENTER));var n=this._map.latLngToContainerPoint(MAP_CENTER);t.fillStyle="rgba(255, 60, 60, 0.2)",t.strokeStyle="rgba(255, 60, 60, 0.9)",t.beginPath(),t.moveTo(n.x,n.y),t.lineTo(300,150),t.stroke()}}),sunPositionLayer=new SunPositionLayer;sunPositionLayer.addTo(map);