"undefined"!=typeof L&&(L.CanvasLayer=L.GridLayer.extend({includes:[L.Evented,L.Mixin.TileLoader],options:{subdomains:"abc",errorTileUrl:"",attribution:"",zoomOffset:0,opacity:1,unloadInvisibleTiles:L.Browser.mobile,updateWhenIdle:L.Browser.mobile,tileLoader:!1},initialize:function(t){t=t||{},this.render=this.render.bind(this),L.Util.setOptions(this,t),this._canvas=this._createCanvas(),this._backCanvas=this._createCanvas(),this._ctx=this._canvas.getContext("2d"),this.currentAnimationFrame=-1,this.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return window.setTimeout(t,1e3/60)},this.cancelAnimationFrame=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame||function(t){clearTimeout(t)}},_createCanvas:function(){var t;(t=document.createElement("canvas")).style.position="absolute",t.style.top=0,t.style.left=0,t.style.pointerEvents="none",t.style.zIndex=this.options.zIndex||0;return t.setAttribute("class","leaflet-tile-container leaflet-zoom-animated"),t},_layerAdd:function(t){var e=this._map=t.target,i=this._map._panes.tilePane,n=L.DomUtil.create("div","leaflet-layer");n.appendChild(this._canvas),n.appendChild(this._backCanvas),this._backCanvas.style.display="none",i.appendChild(n),this._container=n,e.dragging.enabled()&&e.dragging._draggable.on("predrag",function(){var t=e.dragging._draggable;L.DomUtil.setPosition(this._canvas,{x:-t._newPos.x,y:-t._newPos.y})},this),e.on({viewreset:this._reset},this),e.on("move",this.redraw,this),e.on("resize",this._reset,this),e.on({zoomanim:this._animateZoom,zoomend:this._endZoomAnim},this),this.options.tileLoader&&this._initTileLoader(),this._reset()},_animateZoom:function(t){this._animating||(this._animating=!0);var e=this._backCanvas;e.width=this._canvas.width,e.height=this._canvas.height;this._canvas._leaflet_pos;e.getContext("2d").drawImage(this._canvas,0,0),this._canvas.style.display="none",e.style.display="block";var i=this._map,n=(i.getZoomScale(t.zoom),i._latLngToNewLayerPoint(i.getCenter(),t.zoom,t.center)),a=i._latLngToNewLayerPoint(t.center,t.zoom,t.center),s={x:n.x-a.x,y:n.y-a.y},o=e;L.DomUtil.TRANSFORM;L.DomUtil.setTransform(o,s,t.scale)},_endZoomAnim:function(){this._animating=!1,this._canvas.style.display="block",this._backCanvas.style.display="none"},getCanvas:function(){return this._canvas},getAttribution:function(){return this.options.attribution},draw:function(){return this._reset()},onRemove:function(t){this._container.parentNode.removeChild(this._container),t.off({viewreset:this._reset,move:this._render,resize:this._reset,zoomanim:this._animateZoom,zoomend:this._endZoomAnim},this)},addTo:function(t){return t.addLayer(this),this},setOpacity:function(t){return this.options.opacity=t,this._updateOpacity(),this},setZIndex:function(t){this._canvas.style.zIndex=t},bringToFront:function(){return this},bringToBack:function(){return this},_reset:function(){var t=this._map.getSize();this._canvas.width=t.x,this._canvas.height=t.y;var e=L.DomUtil.getPosition(this._map.getPanes().mapPane);e&&L.DomUtil.setPosition(this._canvas,{x:-e.x,y:-e.y}),this.onResize(),this._render()},_updateOpacity:function(){},_render:function(){0<=this.currentAnimationFrame&&this.cancelAnimationFrame.call(window,this.currentAnimationFrame),this.currentAnimationFrame=this.requestAnimationFrame.call(window,this.render)},redraw:function(t){var e=L.DomUtil.getPosition(this._map.getPanes().mapPane);e&&L.DomUtil.setPosition(this._canvas,{x:-e.x,y:-e.y}),t?this.render():this._render()},onResize:function(){},render:function(){throw new Error("render function should be implemented")}}));